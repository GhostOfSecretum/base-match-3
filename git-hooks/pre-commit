#!/bin/bash
# Pre-commit hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏

echo "üîÑ Auto-updating version before commit..."

# –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é
node update-version.cjs

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
if git diff --quiet script.js package.json api/leaderboard.js index.html; then
    echo "‚úÖ Version already up to date"
else
    echo "üì¶ Version updated, adding files to staging..."
    git add script.js package.json api/leaderboard.js index.html
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏–∑ script.js
    NEW_VERSION=$(grep "const APP_VERSION" script.js | sed "s/.*'\(.*\)'.*/\1/")
    
    echo "‚úÖ Version auto-bumped to $NEW_VERSION (files staged)"
fi

exit 0
